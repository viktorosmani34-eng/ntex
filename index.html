<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LagerLogistik Pro - LIVE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-excel-done { background-color: #00ff00 !important; color: black !important; font-weight: 900; }
        .row-prio { background-color: #fef08a !important; border-left: 8px solid #facc15; } 
        .row-problem { background-color: #fee2e2 !important; border-left: 8px solid #f87171; }
        .tab-active { background-color: white !important; border-top: 4px solid #3b82f6 !important; color: #1e40af !important; font-weight: 900 !important; }
        .excel-table input { width: 100%; height: 100%; border: none; outline: none; padding: 12px; background: transparent; text-align: center; font-weight: bold; }
        .excel-table td, .excel-table th { border: 1px solid #cbd5e1; }
        .time-label { font-size: 10px; text-transform: uppercase; color: #94a3b8; font-weight: 900; margin-bottom: -2px; }
        .time-value { font-size: 1.25rem; font-weight: 900; line-height: 1; }
        /* Badge f√∂r In/Ut/Fixa */
        .badge-fixa { background-color: #f59e0b; color: white; }
        .badge-in { background-color: #3b82f6; color: white; }
        .badge-ut { background-color: #10b981; color: white; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-48 font-sans text-slate-700">

    <div class="max-w-6xl mx-auto px-4 pt-6">
        <h1 class="text-2xl font-black text-slate-800 mb-6 flex items-center gap-2">üöõ Tugg Lista</h1>

        <div id="dailyView">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 items-end">
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 mb-1 uppercase">Trailer nr</label>
                        <input id="trailerNr" type="text" class="w-full border border-slate-300 p-3 rounded-lg font-bold outline-none focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 mb-1 uppercase">Port</label>
                        <input id="portNr" type="text" class="w-full border border-slate-300 p-3 rounded-lg font-bold outline-none focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 mb-1 uppercase">Avdelning</label>
                        <select id="deptSelect" class="w-full border border-slate-300 p-3 rounded-lg bg-white font-bold outline-none shadow-sm">
                            <option value="Imp">Imp</option>
                            <option value="Exp">Exp</option>
                            <option value="Secu">Secu</option>
                            <option value="Mattor">Mattor</option>
                            <option value="Xylem">Xylem</option>
                            <option value="Annat">Annat</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 mb-1 uppercase">Typ (In/Ut/Fixa)</label>
                        <select id="typSelect" class="w-full border border-slate-300 p-3 rounded-lg bg-white font-bold outline-none shadow-sm">
                            <option value="In">In</option>
                            <option value="Ut">Ut</option>
                            <option value="Fixa">Fixa</option>
                        </select>
                    </div>
                    <button id="addBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-lg shadow-lg active:scale-95 uppercase text-xs tracking-widest">+ Skapa rad</button>
                </div>
            </div>

            <div class="mb-12">
                <div class="bg-[#1e293b] p-4 rounded-t-xl flex justify-between items-center shadow-lg">
                    <h2 class="text-white text-xs font-black uppercase tracking-widest italic">‚ö†Ô∏è SKA G√ñRAS NU - <span id="currentTabLabel">M√•ndag</span></h2>
                    <span id="activeCount" class="bg-red-500 text-white text-[10px] px-3 py-1 rounded-full font-black">0 st</span>
                </div>
                <div class="bg-white rounded-b-xl shadow-xl overflow-hidden border-x border-b border-slate-300">
                    <table class="w-full border-collapse">
                        <thead class="bg-slate-50 border-b border-slate-200">
                            <tr class="text-[10px] uppercase text-slate-400 font-bold">
                                <th class="p-4 text-left">Trailer</th>
                                <th class="p-4 text-left">Port/Typ</th>
                                <th class="p-4 text-left">Avd</th>
                                <th class="p-4 text-left w-1/4">Status/Notering</th>
                                <th class="p-4 text-left">Beg√§rt</th>
                                <th class="p-4 text-center">√Ötg√§rd</th>
                            </tr>
                        </thead>
                        <tbody id="activeTable"></tbody>
                    </table>
                </div>
            </div>

            <div>
                <div class="bg-slate-200 p-3 rounded-t-xl border-x border-t border-slate-300 flex justify-between items-center">
                    <h2 class="text-slate-500 text-[10px] font-black uppercase tracking-widest italic">‚úÖ REDAN KLARA (HISTORIK)</h2>
                    <button onclick="clearHistory()" class="text-red-500 hover:text-white hover:bg-red-500 text-[10px] font-black uppercase border border-red-300 bg-red-50 px-4 py-1.5 rounded-lg transition-all shadow-sm">üóëÔ∏è Rensa historik</button>
                </div>
                <div id="doneList" class="space-y-3 bg-slate-50/50 p-4 rounded-b-xl border border-slate-300 min-h-[100px]"></div>
            </div>
        </div>

        <div id="statsView" class="hidden">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto">
                <div class="flex justify-between items-center mb-6 text-blue-600 font-black uppercase text-xs">
                    <span>Vecko√∂versikt</span>
                    <button id="newWeekBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700">+ Ny vecka</button>
                </div>
                <table class="w-full excel-table text-sm border-collapse">
                    <thead class="bg-slate-100 font-black">
                        <tr><th>Vecka</th><th>M√•n</th><th>Tis</th><th>Ons</th><th>Tors</th><th>Fre</th><th></th></tr>
                    </thead>
                    <tbody id="excelGridBody"></tbody>
                </table>
            </div>
        </div>
    </div>
<h3 class="text-2m font-black text-slate-800 mb-6 flex items-center gap-2">From Viktor with ‚ù§Ô∏è</h3>
    <div class="fixed bottom-0 left-0 right-0 bg-slate-200 border-t border-slate-400 flex overflow-x-auto shadow-2xl z-50">
        <button onclick="switchTab('M√•ndag')" id="tab-M√•ndag" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-slate-500 border-r border-slate-300 hover:bg-white transition-all">M√•ndag</button>
        <button onclick="switchTab('Tisdag')" id="tab-Tisdag" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-slate-500 border-r border-slate-300 hover:bg-white transition-all">Tisdag</button>
        <button onclick="switchTab('Onsdag')" id="tab-Onsdag" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-slate-500 border-r border-slate-300 hover:bg-white transition-all">Onsdag</button>
        <button onclick="switchTab('Torsdag')" id="tab-Torsdag" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-slate-500 border-r border-slate-300 hover:bg-white transition-all">Torsdag</button>
        <button onclick="switchTab('Fredag')" id="tab-Fredag" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-slate-500 border-r border-slate-300 hover:bg-white transition-all">Fredag</button>
        <button onclick="switchTab('Vecko√∂versikt')" id="tab-Vecko√∂versikt" class="nav-tab px-8 py-4 font-bold text-xs uppercase text-blue-600 bg-blue-50 border-l border-slate-300 ml-auto italic">üìà √ñversikt</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        // Dina Firebase-uppgifter
        const firebaseConfig = {
            apiKey: "AIzaSyCmVuLp-T9f_XGMmUnWZREK2gi8vvsiYb4",
            authDomain: "lagerlogistik-87feb.firebaseapp.com",
            databaseURL: "https://lagerlogistik-87feb-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "lagerlogistik-87feb",
            storageBucket: "lagerlogistik-87feb.firebasestorage.app",
            messagingSenderId: "206906307140",
            appId: "1:206906307140:web:49acbdc1ab3445bc718211"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const trailersRef = ref(db, 'trailers');
        const weeksRef = ref(db, 'weeks');

        let allTrailers = {};
        let allWeeks = {};
        window.currentDay = 'M√•ndag';

        window.switchTab = (tab) => {
            window.currentDay = tab;
            document.getElementById('dailyView').classList.toggle('hidden', tab === 'Vecko√∂versikt');
            document.getElementById('statsView').classList.toggle('hidden', tab !== 'Vecko√∂versikt');
            renderAll();
        };

        document.getElementById('addBtn').onclick = () => {
            const nr = document.getElementById('trailerNr').value.trim();
            const port = document.getElementById('portNr').value.trim();
            if (!nr) return;

            const newTrailerRef = push(trailersRef);
            set(newTrailerRef, {
                nr, port, 
                typ: document.getElementById('typSelect').value,
                avd: document.getElementById('deptSelect').value,
                dag: window.currentDay, status: "Normal", notering: "",
                begart: new Date().toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'}),
                klar: false, timestamp: Date.now()
            });
            document.getElementById('trailerNr').value = "";
            document.getElementById('portNr').value = "";
        };

        window.markDone = (id) => {
            const t = allTrailers[id];
            const now = new Date();
            const utTime = now.toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});
            const [bH, bM] = t.begart.split(':').map(Number);
            let diff = (now.getHours() * 60 + now.getMinutes()) - (bH * 60 + bM);
            if (diff < 0) diff += 1440;
            const total = `${String(Math.floor(diff/60)).padStart(2,'0')}:${String(diff%60).padStart(2,'0')}`;
            update(ref(db, `trailers/${id}`), { klar: true, utford: utTime, total: total });
        };

        window.clearHistory = () => {
            if (confirm(`Rensa ALLA klara uppdrag f√∂r ${window.currentDay}?`)) {
                Object.keys(allTrailers).forEach(id => {
                    if (allTrailers[id].dag === window.currentDay && allTrailers[id].klar) {
                        remove(ref(db, `trailers/${id}`));
                    }
                });
            }
        };

        window.setStatus = (id, stat) => update(ref(db, `trailers/${id}`), { status: stat });
        window.saveNotering = (id, val) => update(ref(db, `trailers/${id}`), { notering: val });
        window.revert = (id) => update(ref(db, `trailers/${id}`), { klar: false });

        onValue(trailersRef, (snapshot) => {
            allTrailers = snapshot.val() || {};
            renderAll();
        });

        onValue(weeksRef, (snapshot) => {
            allWeeks = snapshot.val() || {};
            renderAll();
        });

        function renderAll() {
            const activeTable = document.getElementById('activeTable');
            const doneList = document.getElementById('doneList');
            const excelBody = document.getElementById('excelGridBody');
            
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('tab-active'));
            document.getElementById('tab-' + window.currentDay).classList.add('tab-active');

            if (window.currentDay === 'Vecko√∂versikt') {
                excelBody.innerHTML = "";
                Object.keys(allWeeks).forEach(id => {
                    const w = allWeeks[id];
                    excelBody.innerHTML += `<tr>
                        <td class="p-0"><input type="text" value="${w.name}" onchange="updateWeek('${id}', 'name', this.value)"></td>
                        <td class="p-0"><input type="text" value="${w.mon}" onchange="updateWeek('${id}', 'mon', this.value)"></td>
                        </tr>`;
                });
            } else {
                activeTable.innerHTML = ""; doneList.innerHTML = "";
                let count = 0;
                const sortedIds = Object.keys(allTrailers).sort((a,b) => allTrailers[b].timestamp - allTrailers[a].timestamp);

                sortedIds.forEach(id => {
                    const t = allTrailers[id];
                    if (t.dag === window.currentDay) {
                        const typBadge = t.typ === 'In' ? 'badge-in' : (t.typ === 'Ut' ? 'badge-ut' : 'badge-fixa');
                        
                        if (!t.klar) {
                            count++;
                            activeTable.innerHTML += `<tr class="border-b ${t.status==='PRIO'?'row-prio':''} ${t.status==='Problem'?'row-problem':''}">
                                <td class="p-4 font-black text-3xl tracking-tighter">${t.nr}</td>
                                <td class="p-4 font-bold text-slate-500 text-sm uppercase italic">Port ${t.port}<br><span class="px-2 py-0.5 rounded text-[10px] ${typBadge}">${t.typ}</span></td>
                                <td class="p-4"><span class="bg-slate-100 px-2 py-1 rounded text-[10px] font-black uppercase text-slate-500 border border-slate-200">${t.avd || 'N/A'}</span></td>
                                <td class="p-4">
                                    <select onchange="setStatus('${id}', this.value)" class="bg-white border p-2 rounded text-xs font-bold mb-1 w-full outline-none shadow-sm">
                                        <option ${t.status==='Normal'?'selected':''}>Normal</option>
                                        <option ${t.status==='PRIO'?'selected':''}>PRIO</option>
                                        <option ${t.status==='Problem'?'selected':''}>Problem</option>
                                    </select>
                                    <input type="text" placeholder="..." value="${t.notering||''}" onblur="saveNotering('${id}', this.value)" class="w-full bg-transparent border-b border-slate-300 text-xs py-1 outline-none italic">
                                </td>
                                <td class="p-4 font-black text-slate-400 text-lg">${t.begart}</td>
                                <td class="p-4 text-center"><button onclick="markDone('${id}')" class="bg-green-600 text-white font-black px-10 py-4 rounded-xl shadow-lg uppercase text-xs">KLAR</button></td>
                            </tr>`;
                        } else {
                            doneList.innerHTML += `<div class="flex justify-between items-center p-4 bg-white border border-slate-300 rounded-xl shadow-sm">
                                <div class="flex items-center gap-6">
                                    <div class="bg-excel-done px-6 py-2 rounded-lg text-2xl border border-green-300">${t.nr}</div>
                                    <div class="font-bold text-slate-400 uppercase italic leading-tight">
                                        Port ${t.port} (<span class="text-slate-600">${t.typ}</span>) - <span class="text-blue-400 text-[10px]">${t.avd || ''}</span><br>
                                        <span class="text-slate-800 text-xs font-black not-italic">${t.notering||''}</span>
                                    </div>
                                </div>
                                <div class="flex gap-10 items-center">
                                    <div class="text-center"><p class="time-label">Beg√§rt</p><p class="time-value text-slate-400">${t.begart}</p></div>
                                    <div class="text-center"><p class="time-label">Utf√∂rd</p><p class="time-value text-green-600">${t.utford}</p></div>
                                    <div class="text-center border-l border-slate-200 pl-10"><p class="time-label">Total Tid</p><p class="time-value text-blue-600">${t.total}</p></div>
                                    <button onclick="revert('${id}')" class="text-slate-300 hover:text-blue-500 ml-4 transition-all">‚Ü∫</button>
                                </div>
                            </div>`;
                        }
                    }
                });
                document.getElementById('activeCount').innerText = count + " st";
                document.getElementById('currentTabLabel').innerText = window.currentDay;
            }
        }
    </script>
</body>
</html>



